#!/usr/bin/env bash
# This script lists all currently running processes, including process hierarchy.

printf "%-8s %-5s %-5s %-8s %-8s %-4s %-10s %-5s %s\n" "USER" "PID" "%CPU" "%MEM" "VSZ" "RSS" "TTT" "COMMAND"
while IFS= read -r line; do
  # Extract the relevant process information
  user=$(echo "$line" | awk '{print $1}')
  pid=$(echo "$line" | awk '{print $2}')
  cpu=$(echo "$line" | awk '{print $3}')
  mem=$(echo "$line" | awk '{print $4}')
  vsz=$(echo "$line" | awk '{print $5}')
  rss=$(echo "$line" | awk '{print $6}')
  tty=$(echo "$line" | awk '{print $7}')
  stat=$(echo "$line" | awk '{print $8}')
  command=$(echo "$line" | awk '{print $9}')

  indent=$(echo "$line" | awk '{print substr($0, index($0,$9))}')
  command="$indent$command"

  printf "%-8s %-5s %-5s %-8s %-8s %-4s %-10s %-5s %s\n" "$user" "$pid" "$cpu" "$mem" "$vsz" "$rss" "$tty" "$stat" "$command"

done < <(ps ax -o user,pid,%cpu,%mem,vsz,rss,tty,stat,comm --forest --no-headers)

exit 0
