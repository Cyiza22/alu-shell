#!/usr/bin/env bash

# This script displays a list of currently running processes.

# Display the header
printf "%-8s %-8s %-4s %-4s %-8s %-8s %-4s %-8s %-10s\n" "USER" "PID" "%CPU" "%MEM" "VSZ" "RSS" "TTY" "STAT" "COMMAND"

# Iterate over each process
while IFS= read -r line; do
  # Parse process information
  user=$(echo "$line" | awk '{print $1}')
  pid=$(echo "$line" | awk '{print $2}')
  cpu=$(echo "$line" | awk '{print $3}')
  mem=$(echo "$line" | awk '{print $4}')
  vsz=$(echo "$line" | awk '{print $5}')
  rss=$(echo "$line" | awk '{print $6}')
  tty=$(echo "$line" | awk '{print $7}')
  stat=$(echo "$line" | awk '{print $8}')
  command=$(echo "$line" | awk '{print $9}')

  # Indentation based on process hierarchy
  indentation=""
  if [[ $pid -ne 1 ]]; then
    ppid=$(echo "$line" | awk '{print $10}')
    while [[ $ppid -ne 0 ]]; do
      indentation+="  "
      ppid=$(ps -o ppid= -p "$ppid")
    done
  fi

  # Display the process information
  printf "%-8s %-8s %-4s %-4s %-8s %-8s %-4s %-8s %-10s\n" "$user" "$pid" "$cpu" "$mem" "$vsz" "$rss" "$tty" "$stat" "$indentation$command"
done < <(ps -ef --no-headers)
